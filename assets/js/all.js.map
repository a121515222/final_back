{"version":3,"sources":["all.js"],"names":["tableList","document","querySelector","delAll","api_path","token","headers","authorization","piechart","data","pieObj","forEach","item","products","i","category","undefined","parseInt","quantity","console","log","pieData","Object","keys","push","chart","c3","generate","bindto","columns","type","getOrderData","axios","get","then","response","render","orders","error","tellPaid","paid","showPorductListAndNum","content","index","title","renderList","Today","Date","createdAt","user","name","tel","address","email","getFullYear","getMonth","getDate","id","innerHTML","changeOrderStatus","e","preventDefault","sendData","target","getAttribute","put","delOrder","del","delAllOrder","init","addEventListener"],"mappings":";;AAAA;AAEA,IAAMA,SAAS,GAAGC,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAAlB;AACA,IAAMC,MAAM,GAAGF,QAAQ,CAACC,aAAT,CAAuB,YAAvB,CAAf,C,CAIA;;AAEA,IAAME,QAAQ,GAAG,WAAjB;AACA,IAAMC,KAAK,GAAG;AAAEC,EAAAA,OAAO,EAAE;AAAEC,IAAAA,aAAa,EAAE;AAAjB;AAAX,CAAd,C,CAEA;;AACA,SAASC,QAAT,CAAkBC,IAAlB,EAAwB;AAEtB,MAAMC,MAAM,GAAG,EAAf;AACAD,EAAAA,IAAI,CAACE,OAAL,CAAa,UAACC,IAAD,EAAU;AAErBA,IAAAA,IAAI,CAACC,QAAL,CAAcF,OAAd,CAAsB,UAACG,CAAD,EAAO;AAC3B,UAAIJ,MAAM,CAACI,CAAC,CAACC,QAAH,CAAN,KAAuBC,SAA3B,EAAsC;AACpCN,QAAAA,MAAM,CAACI,CAAC,CAACC,QAAH,CAAN,GAAqBE,QAAQ,CAACH,CAAC,CAACI,QAAH,CAA7B;AACD,OAFD,MAGK;AACHR,QAAAA,MAAM,CAACI,CAAC,CAACC,QAAH,CAAN,IAAsBE,QAAQ,CAACH,CAAC,CAACI,QAAH,CAA9B;AACD;AACF,KAPD;AASD,GAXD;AAYAC,EAAAA,OAAO,CAACC,GAAR,CAAYV,MAAZ;AACA,MAAIW,OAAO,GAAG,EAAd;AAEAC,EAAAA,MAAM,CAACC,IAAP,CAAYb,MAAZ,EAAoBC,OAApB,CAA4B,UAACC,IAAD,EAAU;AACpCS,IAAAA,OAAO,CAACG,IAAR,CAAa,CAACZ,IAAD,EAAOF,MAAM,CAACE,IAAD,CAAb,CAAb;AACD,GAFD;AAGAO,EAAAA,OAAO,CAACC,GAAR,CAAYC,OAAZ;AAEA,MAAMI,KAAK,GAAGC,EAAE,CAACC,QAAH,CAAY;AACxBC,IAAAA,MAAM,EAAE,QADgB;AAExBnB,IAAAA,IAAI,EAAE;AACJoB,MAAAA,OAAO,EAACR,OADJ;AAEJS,MAAAA,IAAI,EAAE;AAFF;AAFkB,GAAZ,CAAd;AASD,C,CACD;;;AACA,SAASC,YAAT,GAAwB;AACtBC,EAAAA,KAAK,CAACC,GAAN,+DAAiE7B,QAAjE,cAAoFC,KAApF,EAA2F6B,IAA3F,CAAgG,UAACC,QAAD,EAAc;AAC5GhB,IAAAA,OAAO,CAACC,GAAR,CAAYe,QAAQ,CAAC1B,IAArB;AACA2B,IAAAA,MAAM,CAACD,QAAQ,CAAC1B,IAAT,CAAc4B,MAAf,CAAN;AACD,GAHD,WAGS,UAACC,KAAD,EAAW;AAAEnB,IAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AAAoB,GAH1C;AAID;;AAED,SAASC,QAAT,CAAkB9B,IAAlB,EAAwB;AACtB,MAAIA,IAAI,CAAC+B,IAAL,KAAc,KAAlB,EAAyB;AACvB,WAAO,KAAP;AACD,GAFD,MAGK;AACH,WAAO,KAAP;AACD;AACF;;AAED,SAASC,qBAAT,CAA+BhC,IAA/B,EAAqC;AACnC,MAAIiC,OAAO,GAAG,EAAd;AACAjC,EAAAA,IAAI,CAACI,QAAL,CAAcF,OAAd,CAAsB,UAACC,IAAD,EAAO+B,KAAP,EAAiB;AACrCD,IAAAA,OAAO,cAAOC,KAAK,GAAG,CAAf,iCAAwB/B,IAAI,CAACgC,KAA7B,gCAAyChC,IAAI,CAACM,QAA9C,SAAP;AACD,GAFD;AAGA,SAAOwB,OAAP;AACD;;AAED,SAASG,UAAT,CAAoBpC,IAApB,EAA0B;AACxB,MAAMqC,KAAK,GAAG,IAAIC,IAAJ,EAAd;AACA,MAAIL,OAAO,yUAAX;AAaAjC,EAAAA,IAAI,CAACE,OAAL,CAAc,UAAAC,IAAI,EAAI;AACpB8B,IAAAA,OAAO,4BACD9B,IAAI,CAACoC,SADJ,uCAGApC,IAAI,CAACqC,IAAL,CAAUC,IAHV,4BAIAtC,IAAI,CAACqC,IAAL,CAAUE,GAJV,sCAMDvC,IAAI,CAACqC,IAAL,CAAUG,OANT,4BAODxC,IAAI,CAACqC,IAAL,CAAUI,KAPT,uCASAZ,qBAAqB,CAAC7B,IAAD,CATrB,sCAWDkC,KAAK,CAACQ,WAAN,EAXC,cAWuBR,KAAK,CAACS,QAAN,KAAmB,CAX1C,cAWgDT,KAAK,CAACU,OAAN,EAXhD,sGAaqC5C,IAAI,CAAC6C,EAb1C,mBAaqD7C,IAAI,CAAC4B,IAb1D,cAakED,QAAQ,CAAC3B,IAAD,CAb1E,uHAgBgEA,IAAI,CAAC6C,EAhBrE,+CAAP;AAmBD,GApBD;AAqBAzD,EAAAA,SAAS,CAAC0D,SAAV,GAAsBhB,OAAtB;AACD,C,CACD;;;AACA,SAASiB,iBAAT,CAA2BC,CAA3B,EAA8B;AAC5BA,EAAAA,CAAC,CAACC,cAAF;AAEA,MAAMC,QAAQ,GAAG;AACf,YAAQ;AACN,YAAM,EADA;AAEN,cAAQ;AAFF;AADO,GAAjB,CAH4B,CAS5B;AACA;;AACA,MAAIF,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,MAAtB,CAAJ,EAAmC;AACjC,QAAIJ,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,MAAtB,MAAkC,OAAtC,EAA+C;AAC7CF,MAAAA,QAAQ,CAACrD,IAAT,CAAc+B,IAAd,GAAqB,IAArB;AACD,KAFD,MAGK;AACHsB,MAAAA,QAAQ,CAACrD,IAAT,CAAc+B,IAAd,GAAqB,KAArB;AACD;;AACDsB,IAAAA,QAAQ,CAACrD,IAAT,CAAcgD,EAAd,GAAmBG,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,SAAtB,CAAnB,CAPiC,CAQjC;;AACAhC,IAAAA,KAAK,CAACiC,GAAN,+DAAiE7D,QAAjE,cAAoF0D,QAApF,EAA8FzD,KAA9F,EAAqG6B,IAArG,CAA0G,UAACC,QAAD,EAAc;AACtHC,MAAAA,MAAM,CAACD,QAAQ,CAAC1B,IAAT,CAAc4B,MAAf,CAAN;AACD,KAFD,WAES,UAACC,KAAD,EAAW;AAClBnB,MAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACD,KAJD;AAKD,GAdD,MAeK;AACH;AACD;AAGF,C,CAED;;;AACA,SAAS4B,QAAT,CAAkBN,CAAlB,EAAqB;AACnBA,EAAAA,CAAC,CAACC,cAAF;AAEA,MAAIM,GAAG,GAAG,EAAV;;AAEA,MAAIP,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,KAAtB,CAAJ,EAAkC;AAChCG,IAAAA,GAAG,GAAGP,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,SAAtB,CAAN;AACAhC,IAAAA,KAAK,UAAL,+DAAoE5B,QAApE,qBAAuF+D,GAAvF,GAA8F9D,KAA9F,EAAqG6B,IAArG,CAA0G,UAACC,QAAD,EAAc;AACtHC,MAAAA,MAAM,CAACD,QAAQ,CAAC1B,IAAT,CAAc4B,MAAf,CAAN;AACD,KAFD,WAES,UAACC,KAAD,EAAW;AAClBnB,MAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACD,KAJD;AAKD;AACF,C,CACD;;;AACA,SAAS8B,WAAT,CAAqBR,CAArB,EAAwB;AACtBA,EAAAA,CAAC,CAACC,cAAF;;AACA,MAAID,CAAC,CAACG,MAAF,CAASC,YAAT,CAAsB,QAAtB,CAAJ,EAAqC;AACnChC,IAAAA,KAAK,UAAL,+DAAoE5B,QAApE,eAAwFC,KAAxF,EAA+F6B,IAA/F,CAAoG,UAACC,QAAD,EAAc;AAChHC,MAAAA,MAAM,CAACD,QAAQ,CAAC1B,IAAT,CAAc4B,MAAf,CAAN;AACD,KAFD,WAES,UAACC,KAAD,EAAW;AAClBnB,MAAAA,OAAO,CAACC,GAAR,CAAYkB,KAAZ;AACD,KAJD;AAKD;AACF,C,CAED;;;AACA,SAASF,MAAT,CAAgB3B,IAAhB,EAAqB;AACnBD,EAAAA,QAAQ,CAACC,IAAD,CAAR;AACAoC,EAAAA,UAAU,CAACpC,IAAD,CAAV;AACD;;AACD,SAAS4D,IAAT,GAAgB;AACdtC,EAAAA,YAAY;AAEb;;AAIDsC,IAAI;AAEJrE,SAAS,CAACsE,gBAAV,CAA2B,OAA3B,EAAoCX,iBAApC,EAAuD,KAAvD;AACA3D,SAAS,CAACsE,gBAAV,CAA2B,OAA3B,EAAoCJ,QAApC,EAA8C,KAA9C;AACA/D,MAAM,CAACmE,gBAAP,CAAwB,OAAxB,EAAiCF,WAAjC,EAA8C,KAA9C","file":"all.js","sourcesContent":["//DOM\n\nconst tableList = document.querySelector('.js-table');\nconst delAll = document.querySelector('.js-delAll');\n\n\n\n//全域變數\n\nconst api_path = \"chun-chia\";\nconst token = { headers: { authorization: \"DW4Cy62MZCRYaSzxl2IyiqqFl8V2\" } };\n\n//畫圖\nfunction piechart(data) {\n\n  const pieObj = {};\n  data.forEach((item) => {\n\n    item.products.forEach((i) => {\n      if (pieObj[i.category] === undefined) {\n        pieObj[i.category] = parseInt(i.quantity)\n      }\n      else {\n        pieObj[i.category] += parseInt(i.quantity)\n      }\n    })\n\n  })\n  console.log(pieObj)\n  let pieData = [];\n\n  Object.keys(pieObj).forEach((item) => {\n    pieData.push([item, pieObj[item]])\n  })\n  console.log(pieData)\n\n  const chart = c3.generate({\n    bindto: '#chart',\n    data: {\n      columns:pieData,\n      type: 'pie',\n\n    }\n  });\n\n}\n//取得資料\nfunction getOrderData() {\n  axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, token).then((response) => {\n    console.log(response.data)\n    render(response.data.orders)\n  }).catch((error) => { console.log(error) })\n}\n\nfunction tellPaid(data) {\n  if (data.paid === false) {\n    return \"未完成\"\n  }\n  else {\n    return \"已完成\"\n  }\n}\n\nfunction showPorductListAndNum(data) {\n  let content = '';\n  data.products.forEach((item, index) => {\n    content += `${index + 1}. 品名：${item.title} 數量：${item.quantity}<br>`\n  })\n  return content\n}\n\nfunction renderList(data) {\n  const Today = new Date();\n  let content = `<thead>\n<tr>\n    <th>訂單編號</th>\n    <th>聯絡人</th>\n    <th>聯絡地址</th>\n    <th>電子郵件</th>\n    <th>訂單品項</th>\n    <th>訂單日期</th>\n    <th>訂單狀態</th>\n    <th>操作</th>\n</tr>\n</thead>`;\n\n  data.forEach((item => {\n    content += `<tr>\n    <td>${item.createdAt}</td>\n    <td>\n      <p>${item.user.name}</p>\n      <p>${item.user.tel}</p>\n    </td>\n    <td>${item.user.address}</td>\n    <td>${item.user.email}</td>\n    <td>\n      <p>${showPorductListAndNum(item)}</p>\n    </td>\n    <td>${Today.getFullYear()}/${(Today.getMonth() + 1)}/${Today.getDate()}</td>\n    <td class=\"orderStatus\">\n      <a href=\"#\" class=\"text-nowrap\" orderID=${item.id} paid=${item.paid}>${tellPaid(item)}</a>\n    </td>\n    <td>\n      <input type=\"button\" class=\"delSingleOrder-Btn\" del=\"true\" orderID=${item.id} value=\"刪除\">\n    </td>\n</tr>`\n  }));\n  tableList.innerHTML = content;\n}\n//更改訂單狀態\nfunction changeOrderStatus(e) {\n  e.preventDefault()\n\n  const sendData = {\n    \"data\": {\n      \"id\": \"\",\n      \"paid\": null\n    }\n  }\n  //console.log(e.target.getAttribute('paid'))\n  //console.log(e.target.getAttribute('orderID'))\n  if (e.target.getAttribute('paid')) {\n    if (e.target.getAttribute('paid') === \"false\") {\n      sendData.data.paid = true;\n    }\n    else {\n      sendData.data.paid = false;\n    }\n    sendData.data.id = e.target.getAttribute('orderID')\n    //console.log(sendData)\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, sendData, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n  else {\n    return\n  }\n\n\n}\n\n//刪除單筆訂單\nfunction delOrder(e) {\n  e.preventDefault()\n\n  let del = '';\n\n  if (e.target.getAttribute('del')) {\n    del = e.target.getAttribute('orderID')\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${del}`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n//刪除有有訂單\nfunction delAllOrder(e) {\n  e.preventDefault()\n  if (e.target.getAttribute('delAll')) {\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n\n//功能集成\nfunction render(data){\n  piechart(data);\n  renderList(data);\n}\nfunction init() {\n  getOrderData()\n\n}\n\n\n\ninit()\n\ntableList.addEventListener('click', changeOrderStatus, false);\ntableList.addEventListener('click', delOrder, false);\ndelAll.addEventListener('click', delAllOrder, false);"]}