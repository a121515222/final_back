{"version":3,"sources":["all.js"],"names":["tableList","document","querySelector","delAll","api_path","token","headers","authorization","piechart","data","pieObj","forEach","item","products","i","category","undefined","parseInt","quantity","console","log","pieData","Object","keys","push","chart","c3","generate","bindto","columns","type","categroyObj","title","categroyArray","categoryArrayObj","name","value","sort","a","b","newcategoryArrayObj","index","number","categoryData","chart2","getOrderData","axios","get","then","response","render","orders","error","tellPaid","paid","showPorductListAndNum","content","renderList","Today","Date","createdAt","user","tel","address","email","getFullYear","getMonth","getDate","id","innerHTML","changeOrderStatus","e","preventDefault","sendData","target","getAttribute","put","delOrder","del","delAllOrder","init","addEventListener"],"mappings":"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","file":"all.js","sourcesContent":["//DOM\n\nconst tableList = document.querySelector('.js-table');\nconst delAll = document.querySelector('.js-delAll');\n\n\n\n//全域變數\n\nconst api_path = \"chun-chia\";\nconst token = { headers: { authorization: \"DW4Cy62MZCRYaSzxl2IyiqqFl8V2\" } };\n\n//畫圖\nfunction piechart(data) {\n//全產品類別營收比重\n  const pieObj = {};\n  data.forEach((item) => {\n\n    item.products.forEach((i) => {\n      if (pieObj[i.category] === undefined) {\n        pieObj[i.category] = parseInt(i.quantity)\n      }\n      else {\n        pieObj[i.category] += parseInt(i.quantity)\n      }\n    })\n\n  })\n  console.log(pieObj)\n  let pieData = [];\n\n  Object.keys(pieObj).forEach((item) => {\n    pieData.push([item, pieObj[item]])\n  })\n  console.log(pieData)\n\n  const chart = c3.generate({\n    bindto: '#chart',\n    data: {\n      columns:pieData,\n      type: 'pie',\n\n    }\n  });\n//全品項營收比重\nconst categroyObj = {};\ndata.forEach((item)=>{\n  item.products.forEach((i) => {\n    if (categroyObj[i.title] === undefined) {\n      categroyObj[i.title] = parseInt(i.quantity)\n    }\n    else {\n      categroyObj[i.title] += parseInt(i.quantity)\n    }\n  })\n})\n\nconsole.log(categroyObj)\n\nlet categroyArray = Object.keys(categroyObj);\nlet categoryArrayObj = [];\ncategroyArray.forEach((item)=>{\n  categoryArrayObj.push({name:item,value:categroyObj[item]})\n});\n//console.log(categoryArrayObj);\n//依照數量排大小，由大至小\n\ncategoryArrayObj.sort((a,b)=>{\n  return b.value - a.value\n});\n//console.log(categoryArrayObj)\n//把數量前三個提出，之後全部加到其他\nconst newcategoryArrayObj=[{name:\"其他\",value:0}]\ncategoryArrayObj.forEach((item,index)=>{\n\n  let number = 0;\n  if(index<3){\n    newcategoryArrayObj.push({name:item.name,value:item.value})\n    //categoryData.push([item.name,item.value])\n  }\n  else{\n    newcategoryArrayObj[0].value+=item.value\n  }\n\n})\nconsole.log(newcategoryArrayObj)\n//組成畫圖的資料\nlet categoryData = [];\nnewcategoryArrayObj.forEach((item)=>{\n  categoryData.push([item.name,item.value])\n})\nconsole.log(categoryData)\n\nconst chart2 = c3.generate({\n  bindto: '#chartCategory',\n  data: {\n    columns:categoryData,\n    type: 'pie',\n\n  }\n});\n\n}\n//取得資料\nfunction getOrderData() {\n  axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, token).then((response) => {\n    console.log(response.data)\n    render(response.data.orders)\n  }).catch((error) => { console.log(error) })\n}\n\nfunction tellPaid(data) {\n  if (data.paid === false) {\n    return \"未完成\"\n  }\n  else {\n    return \"已完成\"\n  }\n}\n\nfunction showPorductListAndNum(data) {\n  let content = '';\n  data.products.forEach((item, index) => {\n    content += `${index + 1}. 品名：${item.title} 數量：${item.quantity}<br>`\n  })\n  return content\n}\n\nfunction renderList(data) {\n  const Today = new Date();\n  let content = `<thead>\n<tr>\n    <th>訂單編號</th>\n    <th>聯絡人</th>\n    <th>聯絡地址</th>\n    <th>電子郵件</th>\n    <th>訂單品項</th>\n    <th>訂單日期</th>\n    <th>訂單狀態</th>\n    <th>操作</th>\n</tr>\n</thead>`;\n\n  data.forEach((item => {\n    content += `<tr>\n    <td>${item.createdAt}</td>\n    <td>\n      <p>${item.user.name}</p>\n      <p>${item.user.tel}</p>\n    </td>\n    <td>${item.user.address}</td>\n    <td>${item.user.email}</td>\n    <td>\n      <p>${showPorductListAndNum(item)}</p>\n    </td>\n    <td>${Today.getFullYear()}/${(Today.getMonth() + 1)}/${Today.getDate()}</td>\n    <td class=\"orderStatus\">\n      <a href=\"#\" class=\"text-nowrap\" orderID=${item.id} paid=${item.paid}>${tellPaid(item)}</a>\n    </td>\n    <td>\n      <input type=\"button\" class=\"delSingleOrder-Btn\" del=\"true\" orderID=${item.id} value=\"刪除\">\n    </td>\n</tr>`\n  }));\n  tableList.innerHTML = content;\n}\n//更改訂單狀態\nfunction changeOrderStatus(e) {\n  e.preventDefault()\n\n  const sendData = {\n    \"data\": {\n      \"id\": \"\",\n      \"paid\": null\n    }\n  }\n  //console.log(e.target.getAttribute('paid'))\n  //console.log(e.target.getAttribute('orderID'))\n  if (e.target.getAttribute('paid')) {\n    if (e.target.getAttribute('paid') === \"false\") {\n      sendData.data.paid = true;\n    }\n    else {\n      sendData.data.paid = false;\n    }\n    sendData.data.id = e.target.getAttribute('orderID')\n    //console.log(sendData)\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, sendData, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n  else {\n    return\n  }\n\n\n}\n\n//刪除單筆訂單\nfunction delOrder(e) {\n  e.preventDefault()\n\n  let del = '';\n\n  if (e.target.getAttribute('del')) {\n    del = e.target.getAttribute('orderID')\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${del}`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n//刪除有有訂單\nfunction delAllOrder(e) {\n  e.preventDefault()\n  if (e.target.getAttribute('delAll')) {\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n\n//功能集成\nfunction render(data){\n  piechart(data);\n  renderList(data);\n}\nfunction init() {\n  getOrderData()\n\n}\n\n\n\ninit()\n\ntableList.addEventListener('click', changeOrderStatus, false);\ntableList.addEventListener('click', delOrder, false);\ndelAll.addEventListener('click', delAllOrder, false);"]}