{"version":3,"sources":["all.js"],"names":["tableList","document","querySelector","delAll","showchart","showOrderEmpty","api_path","token","headers","authorization","piechart","data","pieObj","forEach","item","products","i","category","undefined","parseInt","quantity","pieData","Object","keys","push","chart","c3","generate","bindto","columns","type","categroyObj","title","categroyArray","categoryArrayObj","name","value","sort","a","b","newcategoryArrayObj","index","number","categoryData","chart2","length","classList","remove","add","getOrderData","axios","get","then","response","render","orders","error","console","log","tellPaid","paid","showPorductListAndNum","content","renderList","Today","Date","createdAt","user","tel","address","email","getFullYear","getMonth","getDate","id","innerHTML","changeOrderStatus","e","preventDefault","sendData","target","getAttribute","put","delOrder","del","delAllOrder","init","addEventListener"],"mappings":"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","file":"all.js","sourcesContent":["//DOM\n\nconst tableList = document.querySelector('.js-table');\nconst delAll = document.querySelector('.js-delAll');\nconst showchart = document.querySelector('.js-chart');\nconst showOrderEmpty = document.querySelector('.js-emptyOrder');\n\n//全域變數\n\nconst api_path = \"chun-chia\";\nconst token = { headers: { authorization: \"DW4Cy62MZCRYaSzxl2IyiqqFl8V2\" } };\n\n//畫圖\nfunction piechart(data) {\n  //全產品類別營收比重\n  const pieObj = {};\n  data.forEach((item) => {\n\n    item.products.forEach((i) => {\n      if (pieObj[i.category] === undefined) {\n        pieObj[i.category] = parseInt(i.quantity)\n      }\n      else {\n        pieObj[i.category] += parseInt(i.quantity)\n      }\n    })\n\n  })\n  //console.log(pieObj)\n  let pieData = [];\n\n  Object.keys(pieObj).forEach((item) => {\n    pieData.push([item, pieObj[item]])\n  })\n  //console.log(pieData)\n\n  const chart = c3.generate({\n    bindto: '#chart',\n    data: {\n      columns: pieData,\n      type: 'pie',\n\n    }\n  });\n  //全品項營收比重\n  const categroyObj = {};\n  data.forEach((item) => {\n    item.products.forEach((i) => {\n      if (categroyObj[i.title] === undefined) {\n        categroyObj[i.title] = parseInt(i.quantity)\n      }\n      else {\n        categroyObj[i.title] += parseInt(i.quantity)\n      }\n    })\n  })\n\n  //console.log(categroyObj)\n\n  let categroyArray = Object.keys(categroyObj);\n  let categoryArrayObj = [];\n  categroyArray.forEach((item) => {\n    categoryArrayObj.push({ name: item, value: categroyObj[item] })\n  });\n  //console.log(categoryArrayObj);\n  //依照數量排大小，由大至小\n\n  categoryArrayObj.sort((a, b) => {\n    return b.value - a.value\n  });\n  //console.log(categoryArrayObj)\n  //把數量前三個提出，之後全部加到其他\n  const newcategoryArrayObj = [{ name: \"其他\", value: 0 }]\n  categoryArrayObj.forEach((item, index) => {\n\n    let number = 0;\n    if (index < 3) {\n      newcategoryArrayObj.push({ name: item.name, value: item.value })\n      //categoryData.push([item.name,item.value])\n    }\n    else {\n      newcategoryArrayObj[0].value += item.value\n    }\n\n  })\n  //console.log(newcategoryArrayObj)\n  //組成畫圖的資料\n  let categoryData = [];\n  newcategoryArrayObj.forEach((item) => {\n    categoryData.push([item.name, item.value])\n  })\n  //console.log(categoryData)\n\n  const chart2 = c3.generate({\n    bindto: '#chartCategory',\n    data: {\n      columns: categoryData,\n      type: 'pie',\n\n    }\n  });\n\n  //後台有資料就顯示圖片、與資料、按鈕\n  //console.log(categoryData)\n  if (categoryData.length > 1) {\n    showchart.classList.remove('d-none');\n    delAll.classList.remove('d-none');\n    tableList.classList.remove('d-none');\n    showOrderEmpty.classList.add('d-none');\n    \n\n  }\n\n}\n//取得資料\nfunction getOrderData() {\n  axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, token).then((response) => {\n    //console.log(response.data)\n    render(response.data.orders)\n  }).catch((error) => { console.log(error) })\n}\n\nfunction tellPaid(data) {\n  if (data.paid === false) {\n    return \"未完成\"\n  }\n  else {\n    return \"已完成\"\n  }\n}\n\nfunction showPorductListAndNum(data) {\n  let content = '';\n  data.products.forEach((item, index) => {\n    content += `${index + 1}. 品名：${item.title} 數量：${item.quantity}<br>`\n  })\n  return content\n}\n\nfunction renderList(data) {\n  const Today = new Date();\n  let content = `<thead>\n<tr>\n    <th>訂單編號</th>\n    <th>聯絡人</th>\n    <th>聯絡地址</th>\n    <th>電子郵件</th>\n    <th>訂單品項</th>\n    <th>訂單日期</th>\n    <th>訂單狀態</th>\n    <th>操作</th>\n</tr>\n</thead>`;\n\n  data.forEach((item => {\n    content += `<tr>\n    <td>${item.createdAt}</td>\n    <td>\n      <p>${item.user.name}</p>\n      <p>${item.user.tel}</p>\n    </td>\n    <td>${item.user.address}</td>\n    <td>${item.user.email}</td>\n    <td>\n      <p>${showPorductListAndNum(item)}</p>\n    </td>\n    <td>${Today.getFullYear()}/${(Today.getMonth() + 1)}/${Today.getDate()}</td>\n    <td class=\"orderStatus\">\n      <a href=\"#\" class=\"text-nowrap\" orderID=${item.id} paid=${item.paid}>${tellPaid(item)}</a>\n    </td>\n    <td>\n      <input type=\"button\" class=\"delSingleOrder-Btn\" del=\"true\" orderID=${item.id} value=\"刪除\">\n    </td>\n</tr>`\n  }));\n  tableList.innerHTML = content;\n}\n//更改訂單狀態\nfunction changeOrderStatus(e) {\n  e.preventDefault()\n\n  const sendData = {\n    \"data\": {\n      \"id\": \"\",\n      \"paid\": null\n    }\n  }\n  //console.log(e.target.getAttribute('paid'))\n  //console.log(e.target.getAttribute('orderID'))\n  if (e.target.getAttribute('paid')) {\n    if (e.target.getAttribute('paid') === \"false\") {\n      sendData.data.paid = true;\n    }\n    else {\n      sendData.data.paid = false;\n    }\n    sendData.data.id = e.target.getAttribute('orderID')\n    //console.log(sendData)\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`, sendData, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n  else {\n    return\n  }\n\n\n}\n\n//刪除單筆訂單\nfunction delOrder(e) {\n  e.preventDefault()\n\n  let del = '';\n\n  if (e.target.getAttribute('del')) {\n    del = e.target.getAttribute('orderID')\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${del}`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n//刪除有有訂單\nfunction delAllOrder(e) {\n  e.preventDefault()\n  if (e.target.getAttribute('delAll')) {\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/`, token).then((response) => {\n      render(response.data.orders)\n    }).catch((error) => {\n      console.log(error)\n    })\n  }\n}\n\n//功能集成\nfunction render(data) {\n  piechart(data);\n  renderList(data);\n}\nfunction init() {\n  getOrderData()\n\n}\n\n\n\ninit()\n\ntableList.addEventListener('click', changeOrderStatus, false);\ntableList.addEventListener('click', delOrder, false);\ndelAll.addEventListener('click', delAllOrder, false);"]}